generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id                String  @id @default(cuid())
  type              String
  provider          String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  providerAccountId String  @map("provider_account_id")
  userId            String  @map("user_id")
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  expires      DateTime
  sessionToken String   @unique @map("session_token")
  userId       String   @map("user_id")
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model User {
  id                       String                   @id @default(cuid())
  email                    String                   @unique
  createdAt                DateTime                 @default(now())
  updatedAt                DateTime                 @updatedAt
  password                 String?
  image                    String?
  name                     String?
  emailVerified            DateTime?                @map("email_verified")
  role                     UserRole                 @default(CLIENT)
  company                  String?
  invitedById              String?
  phone                    String?
  profileDoneAt            DateTime?
  tosAcceptedAt            DateTime?
  tosVersion               String?
  twofaEnabled             Boolean                  @default(false)
  twofaSecret              String?
  questionnaireCompleted   DateTime?
  // REMOVED: briefQuestionnaireId (orphaned, conflicts with ProjectRequest system)
  // New fields for enhanced auth & profile
  username                 String?                  @unique
  bio                      String?
  profileImageUrl          String?
  location                 String?
  timezone                 String?
  lastLogin                DateTime?
  emailVerificationToken   String?                  @unique
  emailVerificationExpires DateTime?
  // Existing relations
  accounts                 Account[]
  activities               Activity[]
  assignmentsCreated       Assignment[]             @relation("AssignmentCreatedBy")
  channelMemberships       ChannelMember[]
  messages                 ChatMessage[]
  completions              Completion[]             @relation("CompletionUser")
  notifications            Notification[]
  organizations            OrganizationMember[]
  projectRequests          ProjectRequest[]
  assignedProjects         Project[]                @relation("ProjectAssignee")
  resourcesCreated         Resource[]               @relation("ResourceCreatedBy")
  sessions                 Session[]
  signatures               Signature[]
  createdInviteCodes       StaffInviteCode[]        @relation("InviteCodeCreator")
  systemLogs               SystemLog[]
  assignedTodos            Todo[]                   @relation("TodoAssignee")
  createdTodos             Todo[]                   @relation("TodoCreator")
  trainingsCreated         Training[]               @relation("TrainingCreatedBy")
  revenueSplitsCreated     RevenueSplit[]           @relation("RevenueSplitCreatedBy")
  clientTasksCreated       ClientTask[]             @relation("ClientTaskCreatedBy")
  leads                    Lead[]
  invitedBy                User?                    @relation("Inviter", fields: [invitedById], references: [id])
  invitees                 User[]                   @relation("Inviter")
  // New relations
  profile                  UserProfile?
  twoFactorAuth            TwoFactorAuth?
  userSessions             UserSession[]            @relation("UserSessions")
  notificationPreferences  NotificationPreferences?
  userPreferences          UserPreferences?
  tosAcceptances           TosAcceptance[]
  loginHistory             LoginHistory[]
  recordingsUploaded       Recording[]              @relation("RecordingsUploaded")
  ownedGoals               Goal[]                   @relation("GoalOwner")
  createdGoals             Goal[]                   @relation("GoalCreator")
  blogPosts                BlogPost[]               @relation("BlogAuthor")
  vaultEntries             VaultEntry[]             @relation("VaultCreator")

  @@map("users")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verificationtokens")
}

model Organization {
  id               String               @id @default(cuid())
  name             String
  slug             String               @unique
  website          String?
  createdAt        DateTime             @default(now())
  updatedAt        DateTime             @updatedAt
  address          String?
  billingEmail     String?
  city             String?
  country          String?              @default("US")
  email            String?
  phone            String?
  state            String?
  taxId            String?
  zipCode          String?
  stripeCustomerId String?
  invoices         Invoice[]
  leads            Lead[]
  members          OrganizationMember[]
  projects         Project[]

  // Enhanced organization fields
  industry            String?
  annualBudget        Int?
  leadSource          String?
  convertedFromLeadId String?

  // Relations
  financeTransactions FinanceTransaction[]
  calendarEvents      CalendarEvent[]

  @@map("organizations")
}

model OrganizationMember {
  id             String       @id @default(cuid())
  organizationId String
  userId         String
  role           OrgRole      @default(MEMBER)
  joinedAt       DateTime     @default(now())
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([organizationId, userId])
  @@map("organization_members")
}

model Lead {
  id             String           @id @default(cuid())
  name           String
  email          String
  message        String?
  createdAt      DateTime         @default(now())
  company        String?
  budget         String?
  phone          String?
  source         String?          @default("website")
  timeline       String?
  updatedAt      DateTime         @updatedAt
  convertedAt    DateTime?
  organizationId String?
  userId         String?
  requirements   Json?
  serviceType    ServiceCategory?
  status         LeadStatus       @default(NEW)
  metadata       Json?
  internalNotes  String?
  organization   Organization?    @relation(fields: [organizationId], references: [id])
  user           User?            @relation(fields: [userId], references: [id])
  project        Project?

  // Prospect/Client Finder fields
  ein                String? // Tax ID for nonprofits
  websiteUrl         String?
  address            String?
  city               String?
  state              String?
  zipCode            String?
  country            String          @default("US")
  latitude           Float?
  longitude          Float?
  category           String? // Arts, Education, Health, etc.
  subcategory        String?
  annualRevenue      Int? // Estimated annual revenue
  employeeCount      Int?
  leadScore          Int             @default(0) // 0-100
  hasWebsite         Boolean         @default(false)
  websiteQuality     WebsiteQuality?
  needsAssessment    Json? // { responsive: false, accessible: false, etc. }
  assignedToId       String?
  lastContactedAt    DateTime?
  emailsSent         Int             @default(0)
  lastEmailSentAt    DateTime?
  outreachCampaignId String?
  tags               String[]

  emailCampaigns EmailCampaign[] @relation("LeadCampaigns")
  prospect       Prospect?       @relation("ProspectToLead")

  @@index([status])
  @@index([leadScore])
  @@index([city, state])
  @@index([email, serviceType, createdAt])
  @@map("leads")
}

// Prospects are potential leads discovered through lead finder
// They become actual leads only when user clicks "Reach Out"
model Prospect {
  id        String   @id @default(cuid())
  name      String
  email     String   @default("") // May be empty from discovery
  phone     String?
  company   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Discovery source
  source            String @default("GOOGLE_PLACES")
  discoveryMetadata Json? // Store original discovery data

  // Address fields
  address   String?
  city      String?
  state     String?
  zipCode   String?
  country   String  @default("US")
  latitude  Float?
  longitude Float?

  // Business info
  ein           String?
  category      String?
  subcategory   String?
  annualRevenue Int?
  employeeCount Int?

  // Website info
  websiteUrl      String?
  hasWebsite      Boolean         @default(false)
  websiteQuality  WebsiteQuality?
  needsAssessment Json?

  // Google Places data
  googlePlaceId String? @unique
  googleRating  Float?
  googleReviews Int?

  // Scoring
  leadScore           Int      @default(0)
  websiteQualityScore Int? // 0-20 (scoring breakdown)
  revenuePotential    Int? // 0-25
  categoryFit         Int? // 0-25
  locationScore       Int? // 0-15
  organizationSize    Int? // 0-10
  googleScore         Int? // 0-5 (Google rating/reviews score)
  urgencyLevel        String? // "HIGH", "MEDIUM", "LOW"
  tags                String[]

  // AI Analysis
  aiAnalysis    Json? // Store AI analysis results
  opportunities String[] // ["No website", "Poor mobile experience"]
  redFlags      String[] // ["Low rating", "Negative reviews"]

  // Workflow Status
  status   ProspectStatus @default(PROSPECT)
  archived Boolean        @default(false)

  // Outreach
  emailDraft      String?
  emailSentAt     DateTime?
  emailOpenedAt   DateTime?
  emailRepliedAt  DateTime?
  lastContactedAt DateTime?
  followUpDate    DateTime?

  // Conversion tracking
  convertedToLeadId String?   @unique
  convertedToLead   Lead?     @relation("ProspectToLead", fields: [convertedToLeadId], references: [id])
  convertedAt       DateTime?

  // Internal notes
  internalNotes String?

  // Cold call script
  callScript            String?   @db.Text
  callScriptGeneratedAt DateTime?

  // Relations
  activities      ProspectActivity[]
  emails          SentEmail[]
  dripEnrollments DripEnrollment[]

  @@index([leadScore])
  @@index([city, state])
  @@index([convertedAt])
  @@index([source])
  @@index([status])
  @@index([archived])
  @@map("prospects")
}

// Prospect-specific activity tracking
model ProspectActivity {
  id          String       @id @default(cuid())
  createdAt   DateTime     @default(now())
  prospectId  String
  prospect    Prospect     @relation(fields: [prospectId], references: [id], onDelete: Cascade)
  type        ActivityType
  description String
  metadata    Json?

  @@index([prospectId])
  @@index([createdAt])
  @@map("prospect_activities")
}

// Sent emails tracking with Resend integration
model SentEmail {
  id         String   @id @default(cuid())
  createdAt  DateTime @default(now())
  prospectId String
  prospect   Prospect @relation(fields: [prospectId], references: [id], onDelete: Cascade)

  from    String
  to      String
  subject String
  body    String @db.Text

  sentAt      DateTime?
  deliveredAt DateTime?
  openedAt    DateTime?
  clickedAt   DateTime?
  bouncedAt   DateTime?
  repliedAt   DateTime?

  resendId String? // ID from Resend API
  status   EmailStatus @default(DRAFT)

  @@index([prospectId])
  @@index([status])
  @@index([sentAt])
  @@index([resendId])
  @@map("sent_emails")
}

model Project {
  id                   String                @id @default(cuid())
  name                 String
  description          String?
  status               ProjectStatus         @default(LEAD)
  isNonprofit          Boolean               @default(false)
  budget               Decimal?
  startDate            DateTime?
  endDate              DateTime?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  assigneeId           String?
  leadId               String?               @unique
  organizationId       String
  questionnaireId      String?               @unique
  stripeCustomerId     String?
  stripeSubscriptionId String?
  maintenancePlan      String?
  maintenanceStatus    String?
  nextBillingDate      DateTime?
  githubRepo           String?
  vercelUrl            String?
  feedEvents           FeedEvent[]
  files                File[]
  folders              ProjectFolder[]
  invoices             Invoice[]
  maintenanceSchedules MaintenanceSchedule[]
  messageThreads       MessageThread[]
  milestones           ProjectMilestone[]
  clientTasks          ClientTask[]
  projectQuestionnaire ProjectQuestionnaire?
  revenueSplits        RevenueSplit[]
  maintenancePlanRel   MaintenancePlan?
  assignee             User?                 @relation("ProjectAssignee", fields: [assigneeId], references: [id])
  lead                 Lead?                 @relation(fields: [leadId], references: [id])
  organization         Organization          @relation(fields: [organizationId], references: [id])
  questionnaire        Questionnaire?        @relation(fields: [questionnaireId], references: [id])
  requests             Request[]
  subscriptions        Subscription[]
  changeRequests       ChangeRequest[]
  unifiedRequests      UnifiedRequest[]
  todos                Todo[]

  // Enhanced project tracking fields
  currentStage     ProjectStage @default(DISCOVERY)
  progress         Int          @default(0) // 0-100
  designFiles      String[] // URLs to Figma, etc.
  designApprovedAt DateTime?
  launchedAt       DateTime?
  liveUrl          String?

  // Vercel integration
  vercelProjectId String?
  vercelTeamId    String?
  // vercelUrl is defined above with githubRepo

  // Relations
  financeTransactions FinanceTransaction[]
  recordings          Recording[]
  calendarEvents      CalendarEvent[]

  @@index([organizationId, leadId])
  @@map("projects")
}

model ProjectMilestone {
  id          String    @id @default(cuid())
  title       String
  description String?
  dueDate     DateTime?
  completed   Boolean   @default(false)
  completedAt DateTime?
  projectId   String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  project     Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  todos       Todo[] // Tasks linked to this milestone

  @@index([projectId])
  @@map("project_milestones")
}

model Invoice {
  id          String        @id @default(cuid())
  number      String        @unique
  status      InvoiceStatus @default(DRAFT)
  total       Decimal // Calculated from items
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  currency    String        @default("USD")
  title       String
  description String?
  dueDate     DateTime
  paidAt      DateTime?
  sentAt      DateTime?

  // Relations
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])
  projectId      String?
  project        Project?     @relation(fields: [projectId], references: [id])

  // Stripe integration
  stripeInvoiceId  String? @unique
  stripePaymentUrl String? // Hosted invoice URL

  // Line items (handles all pricing including tax)
  items    InvoiceItem[]
  payments Payment[]

  // Flexible metadata for invoice types and custom data
  metadata Json? // Store: invoiceType, isFirstInvoice, custom fields, etc.

  // Internal notes (not shown to client)
  internalNotes String? @db.Text

  @@index([organizationId])
  @@index([projectId])
  @@index([status])
  @@map("invoices")
}

model InvoiceItem {
  id          String  @id @default(cuid())
  description String
  quantity    Int     @default(1)
  rate        Decimal
  amount      Decimal
  invoiceId   String
  invoice     Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@map("invoice_items")
}

model Payment {
  id              String        @id @default(cuid())
  amount          Decimal
  status          PaymentStatus @default(PENDING)
  method          String?
  createdAt       DateTime      @default(now())
  currency        String        @default("USD")
  invoiceId       String?
  processedAt     DateTime?
  stripeChargeId  String?
  stripePaymentId String?
  invoice         Invoice?      @relation(fields: [invoiceId], references: [id])

  @@map("payments")
}

model MaintenancePlan {
  id                      String                @id @default(cuid())
  projectId               String                @unique
  tier                    String // NonprofitTier value: ESSENTIALS, DIRECTOR, COO
  monthlyPrice            Decimal
  features                Json?
  billingDay              Int                   @default(1)
  status                  MaintenancePlanStatus @default(ACTIVE)
  stripeSubscriptionId    String?
  stripeCheckoutSessionId String?
  createdAt               DateTime              @default(now())
  updatedAt               DateTime              @updatedAt
  cancelledAt             DateTime?
  project                 Project               @relation(fields: [projectId], references: [id], onDelete: Cascade)

  // Subscription limits per tier
  subscriptionsIncluded Int @default(2) // Subscriptions included in base tier
  maxSubscriptions      Int @default(3) // Hard cap per tier

  // Hours tracking - support hours pool
  supportHoursIncluded Int   @default(8) // Monthly support hours included (doubled from 4)
  supportHoursUsed     Float @default(0) // Support hours used this period

  // Change request tracking - separate from support hours
  changeRequestsIncluded Int @default(3) // Change requests per month
  changeRequestsUsed     Int @default(0) // Requests used this period

  // Billing period
  currentPeriodStart DateTime?
  currentPeriodEnd   DateTime?

  // Rollover hours system
  rolloverEnabled Boolean @default(true)
  rolloverCap     Int     @default(16) // Max rollover hours (2x monthly, doubled from 8)
  rolloverHours   Float   @default(0) // Current banked rollover hours

  // On-demand billing settings
  onDemandEnabled       Boolean @default(false)
  hourlyOverageRate     Int     @default(7500) // $75.00 in cents
  dailyRequestLimit     Int     @default(3) // Max requests per day in on-demand mode
  dailySpendCap         Int     @default(50000) // $500 daily cap in cents
  monthlySpendCap       Int     @default(200000) // $2000 monthly cap in cents
  urgentRequestsPerWeek Int     @default(2) // Max urgent requests per week
  urgentRequestsUsed    Int     @default(0) // Urgent requests used this week

  // Daily tracking for on-demand
  requestsToday   Int       @default(0)
  lastRequestDate DateTime?

  // Grace period tracking
  gracePeriodUsed Boolean @default(false) // One-time 1hr grace used

  // Usage tracking
  logs                 MaintenanceLog[]
  hourPacks            HourPack[]
  rolloverRecords      RolloverHours[]
  overageNotifications OverageNotification[]
  changeRequests       ChangeRequest[]

  @@map("maintenance_plans")
}

model PricingRule {
  id                 String    @id @default(cuid())
  name               String    @unique
  description        String?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  active             Boolean   @default(true)
  basePrice          Decimal
  extendedMultiplier Decimal?  @default(0.9)
  features           Json?
  rushMultiplier     Decimal?  @default(1.5)
  serviceType        String
  standardMultiplier Decimal?  @default(1.0)
  validFrom          DateTime  @default(now())
  validTo            DateTime?
  quotes             Quote[]

  @@map("pricing_rules")
}

model Quote {
  id                 String      @id @default(cuid())
  serviceType        String
  timeline           String
  features           Json?
  requirements       Json?
  basePrice          Decimal
  featurePrice       Decimal     @default(0)
  timelineMultiplier Decimal     @default(1.0)
  subtotal           Decimal
  tax                Decimal     @default(0)
  total              Decimal
  customerName       String?
  customerEmail      String?
  pricingRuleId      String
  convertedToLead    Boolean     @default(false)
  convertedAt        DateTime?
  expiresAt          DateTime
  createdAt          DateTime    @default(now())
  pricingRule        PricingRule @relation(fields: [pricingRuleId], references: [id])

  @@map("quotes")
}

model ProjectFolder {
  id          String          @id @default(cuid())
  projectId   String
  project     Project         @relation(fields: [projectId], references: [id], onDelete: Cascade)
  name        String
  description String?
  parentId    String?
  parent      ProjectFolder?  @relation("FolderHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  children    ProjectFolder[] @relation("FolderHierarchy")
  files       File[]
  color       String?         @default("#6b7280") // For visual organization
  icon        String?         @default("folder")
  order       Int             @default(0)
  isSystem    Boolean         @default(false) // For default folders like "Contracts", "Deliverables"
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@index([projectId])
  @@index([parentId])
  @@map("project_folders")
}

model File {
  id              String          @id @default(cuid())
  name            String
  size            Int
  url             String
  createdAt       DateTime        @default(now())
  mimeType        String
  originalName    String
  projectId       String?
  folderId        String?
  folder          ProjectFolder?  @relation(fields: [folderId], references: [id], onDelete: SetNull)
  scanResult      String?
  type            FileType
  uploadedById    String?
  virusScanStatus VirusScanStatus @default(PENDING)
  project         Project?        @relation(fields: [projectId], references: [id])

  // Additional metadata
  tags     String[] @default([])
  version  Int      @default(1)
  isLatest Boolean  @default(true)

  @@index([projectId])
  @@index([folderId])
  @@map("files")
}

model Signature {
  id            String   @id @default(cuid())
  signedAt      DateTime @default(now())
  documentId    String
  ipAddress     String?
  signatureData String
  signerEmail   String
  signerName    String
  userAgent     String?
  userId        String?
  user          User?    @relation(fields: [userId], references: [id])

  @@map("signatures")
}

model Notification {
  id        String           @id @default(cuid())
  type      NotificationType @default(INFO)
  title     String
  message   String
  createdAt DateTime         @default(now())
  read      Boolean          @default(false)
  userId    String
  projectId String?
  user      User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@map("notifications")
}

model WebhookEvent {
  id        String   @id @default(cuid())
  eventId   String   @unique
  type      String
  data      Json
  processed Boolean  @default(false)
  createdAt DateTime @default(now())

  @@map("webhook_events")
}

model Channel {
  id          String          @id @default(cuid())
  name        String
  description String?
  type        ChannelType     @default(GENERAL)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  members     ChannelMember[]
  messages    ChatMessage[]

  @@map("channels")
}

model ChannelMember {
  id        String   @id @default(cuid())
  channelId String
  userId    String
  joinedAt  DateTime @default(now())
  channel   Channel  @relation(fields: [channelId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([channelId, userId])
  @@map("channel_members")
}

model ChatMessage {
  id        String   @id @default(cuid())
  content   String
  channelId String
  authorId  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  author    User     @relation(fields: [authorId], references: [id])
  channel   Channel  @relation(fields: [channelId], references: [id], onDelete: Cascade)

  @@map("chat_messages")
}

model Todo {
  id              String            @id @default(cuid())
  title           String
  description     String?
  status          TodoStatus        @default(TODO)
  priority        TodoPriority      @default(MEDIUM)
  assignedToId    String?
  createdById     String
  projectId       String?
  milestoneId     String? // Link to project milestone
  changeRequestId String?           @unique // Link to change request if auto-generated
  dueDate         DateTime?
  completedAt     DateTime?
  submittedAt     DateTime?
  submissionNotes String?
  approvedAt      DateTime?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  assignedTo      User?             @relation("TodoAssignee", fields: [assignedToId], references: [id])
  createdBy       User              @relation("TodoCreator", fields: [createdById], references: [id])
  project         Project?          @relation(fields: [projectId], references: [id])
  milestone       ProjectMilestone? @relation(fields: [milestoneId], references: [id])
  changeRequest   ChangeRequest?    @relation(fields: [changeRequestId], references: [id])

  // Team/Role assignment fields
  assignedToRole   UserRole? // If assigned to a role group
  assignedToTeamId String? // If assigned to a team/organization

  // Kanban board fields
  column         String   @default("todo") // "todo", "in-progress", "review", "done"
  position       Int      @default(0) // for ordering within column
  estimatedHours Float?
  actualHours    Float?
  dependencies   String[] // Task IDs this task depends on
  attachments    String[] // File URLs

  // AI-generated fields
  aiGenerated Boolean @default(false) // Was this task generated by AI
  aiContext   Json? // Context used to generate task (for learning)

  // Time tracking
  timeLogs TimeLog[]

  // Learning materials and resources
  materials TaskMaterial[]
  
  // Execution requests (AI Nodes system)
  executionRequests ExecutionRequest[]

  @@index([projectId, column])
  @@index([milestoneId])
  @@index([status])
  @@index([changeRequestId])
  @@index([assignedToRole])
  @@index([assignedToTeamId])
  @@map("todos")
}

// Task Materials - Learning resources, PDFs, assignments attached to tasks
model TaskMaterial {
  id          String           @id @default(cuid())
  todoId      String
  todo        Todo             @relation(fields: [todoId], references: [id], onDelete: Cascade)
  title       String
  description String?
  type        TaskMaterialType
  fileUrl     String? // For uploaded files (PDFs, videos, images)
  linkUrl     String? // For external links/resources
  fileName    String? // Original file name
  fileSize    Int? // File size in bytes
  mimeType    String? // File MIME type
  dueDate     DateTime? // For assignments - when it's due
  isRequired  Boolean          @default(false) // Whether this material is required
  order       Int              @default(0) // Display order
  createdById String
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  @@index([todoId])
  @@index([type])
  @@index([createdById])
  @@map("task_materials")
}

enum TaskMaterialType {
  PDF // PDF documents
  DOCUMENT // Word docs, text files, etc.
  VIDEO // Video files or links
  IMAGE // Image files
  LINK // External links/resources
  ASSIGNMENT // Assignments with due dates
  RESOURCE // General resources
}

// ============================================
// AI NODES + GIT AGENTS EXECUTION SYSTEM
// ============================================

model WorkflowNode {
  id              String            @id @default(cuid())
  name            String
  type            String            @default("GIT_AGENT") // GIT_AGENT, PC_WORKER, etc.
  status          NodeStatus        @default(OFFLINE)
  apiKeyId        String            @unique // Public key ID for lookup
  apiKeyHash      String // Bcrypt hash of the secret
  capabilities    Json?             @default("{}") // { git: true, build: true, test: true }
  lastHeartbeatAt DateTime?
  currentJobId    String? // Current ExecutionRun ID if busy
  metadata        Json?             @default("{}") // Extra config (repo defaults, etc.)
  
  executionRuns   ExecutionRun[]
  claimedRequests ExecutionRequest[] @relation("ClaimedByNode")
  
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  @@index([lastHeartbeatAt])
  @@index([status])
  @@map("workflow_nodes")
}

model ExecutionRequest {
  id              String               @id @default(cuid())
  todoId          String
  todo            Todo                 @relation(fields: [todoId], references: [id], onDelete: Cascade)
  
  targetNodeId    String? // Optional: assign to specific node
  targetNode      WorkflowNode?        @relation("ClaimedByNode", fields: [targetNodeId], references: [id], onDelete: SetNull)
  
  repoUrl         String // GitHub repo URL
  branchName      String // Generated: seezee/req-{requestId}
  priority        RequestPriority      @default(MEDIUM)
  status          ExecutionRequestStatus @default(QUEUED)
  
  claimedByNodeId String? // Node that claimed this request
  claimedAt       DateTime?
  expiresAt       DateTime? // Claim expires after 10 minutes
  completedAt     DateTime?
  
  runs            ExecutionRun[]
  
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt

  @@index([status, priority, createdAt])
  @@index([todoId])
  @@map("execution_requests")
}

model ExecutionRun {
  id              String        @id @default(cuid())
  requestId       String
  request         ExecutionRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  
  nodeId          String
  node            WorkflowNode  @relation(fields: [nodeId], references: [id], onDelete: Cascade)
  
  status          RunStatus     @default(RUNNING)
  branchName      String // Copied from request
  prUrl           String? // GitHub PR URL
  previewUrl      String? // Vercel preview URL
  errorMessage    String? // Error details if FAILED
  summary         String?       @db.Text // What changed + how to test
  questions       Json? // Questions for Ask Sean flow
  answers         Json? // Answers from Sean
  
  startedAt       DateTime      @default(now())
  completedAt     DateTime?
  
  logs            RunLog[]
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@index([status, nodeId, createdAt])
  @@index([requestId])
  @@index([branchName])
  @@map("execution_runs")
}

model RunLog {
  id        String   @id @default(cuid())
  runId     String
  run       ExecutionRun @relation(fields: [runId], references: [id], onDelete: Cascade)
  
  timestamp DateTime @default(now())
  level     String   @default("info") // info, warn, error
  message   String   @db.Text
  truncated Boolean  @default(false)
  
  @@index([runId, timestamp])
  @@map("run_logs")
}

// ============================================
// VAULT - Secret References & Key Storage
// ============================================

model VaultEntry {
  id             String     @id @default(cuid())
  key            String // Display name / label
  encryptedValue String     @db.Text // AES-256 encrypted value
  lastFour       String // Last 4 chars for display
  scope          VaultScope @default(GLOBAL)
  scopeRef       String? // Project ID or repo URL when scoped
  notes          String? // Optional description
  createdById    String
  createdBy      User       @relation("VaultCreator", fields: [createdById], references: [id])
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  @@unique([key, scope, scopeRef])
  @@index([scope])
  @@index([createdById])
  @@map("vault_entries")
}

enum VaultScope {
  GLOBAL
  PROJECT
  REPO
}

model Goal {
  id           String       @id @default(cuid())
  title        String
  description  String?
  status       GoalStatus   @default(NOT_STARTED)
  priority     GoalPriority @default(MEDIUM)
  category     String? // e.g., "Revenue", "Team", "Marketing", "Product"
  targetValue  Float? // Numeric goal target
  currentValue Float?       @default(0) // Current progress value
  unit         String? // e.g., "$", "clients", "projects", "%"
  startDate    DateTime
  targetDate   DateTime
  completedAt  DateTime?
  ownerId      String // Person responsible for this goal
  owner        User         @relation("GoalOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  teamMembers  String[] // Array of user IDs contributing to goal
  milestones   Json? // Array of milestone objects
  notes        String?
  createdById  String
  createdBy    User         @relation("GoalCreator", fields: [createdById], references: [id])
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  @@index([status])
  @@index([ownerId])
  @@index([targetDate])
  @@map("goals")
}

model BlogPost {
  id             String     @id @default(cuid())
  title          String
  slug           String     @unique
  excerpt        String?
  content        String // Full blog post content (Markdown or HTML)
  coverImage     String? // Cover image URL
  status         BlogStatus @default(DRAFT)
  publishedAt    DateTime?
  authorId       String
  author         User       @relation("BlogAuthor", fields: [authorId], references: [id], onDelete: Cascade)
  tags           String[] // Array of tags
  category       String? // e.g., "Web Development", "Design", "Marketing"
  seoTitle       String?
  seoDescription String?
  viewCount      Int        @default(0)
  featured       Boolean    @default(false) // Featured on homepage
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  @@index([status, publishedAt])
  @@index([slug])
  @@index([authorId])
  @@index([featured])
  @@map("blog_posts")
}

model SystemLog {
  id         String   @id @default(cuid())
  action     String
  entityType String
  entityId   String
  userId     String
  metadata   Json?
  createdAt  DateTime @default(now())
  area       String?
  message    String?
  meta       Json?
  refId      String?
  user       User     @relation(fields: [userId], references: [id])

  @@index([entityType, entityId])
  @@index([userId])
  @@index([createdAt])
  @@index([area, refId])
  @@map("system_logs")
}

model StaffInviteCode {
  id          String    @id @default(cuid())
  email       String
  role        UserRole
  codeHash    String
  createdById String
  expiresAt   DateTime
  redeemedAt  DateTime?
  attempts    Int       @default(0)
  maxAttempts Int       @default(5)
  createdAt   DateTime  @default(now())
  createdBy   User      @relation("InviteCodeCreator", fields: [createdById], references: [id])

  @@index([email])
  @@map("staff_invite_codes")
}

model Message {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  content   String
  email     String
  name      String
  status    String   @default("UNREAD")
  subject   String?

  @@map("messages")
}

model Questionnaire {
  id        String   @id @default(cuid())
  userEmail String
  data      Json
  estimate  Int?
  deposit   Int?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  project   Project?

  @@map("questionnaires")
}

model Subscription {
  id                    String          @id @default(cuid())
  projectId             String
  stripeId              String          @unique
  priceId               String
  status                String
  currentPeriodEnd      DateTime?
  createdAt             DateTime        @default(now())
  updatedAt             DateTime        @updatedAt
  planName              String? // "Standard Monthly", "Premium Monthly", "Standard Annual", "Premium Annual"
  changeRequestsAllowed Int             @default(2) // Number of change requests allowed per period
  changeRequestsUsed    Int             @default(0) // Number of change requests used in current period
  resetDate             DateTime? // When change requests reset
  project               Project         @relation(fields: [projectId], references: [id], onDelete: Cascade)
  changeRequests        ChangeRequest[]

  // Addon subscription support
  isAddon         Boolean @default(false) // True if this is an addon beyond included
  additionalCost  Int     @default(0) // Additional monthly cost in cents
  additionalHours Int     @default(0) // Additional hours this addon provides

  @@map("subscriptions")
}

model Request {
  id        String        @id @default(cuid())
  projectId String
  title     String
  details   String
  state     String        @default("new")
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  source    RequestSource @default(MANUAL)
  project   Project       @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("requests")
}

model ChangeRequest {
  id                String           @id @default(cuid())
  projectId         String
  subscriptionId    String? // Optional - for legacy data only
  maintenancePlanId String? // Primary relationship going forward
  description       String
  status            String           @default("pending") // "pending", "approved", "in_progress", "completed", "rejected"
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  completedAt       DateTime?
  project           Project          @relation(fields: [projectId], references: [id], onDelete: Cascade)
  subscription      Subscription?    @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
  maintenancePlan   MaintenancePlan? @relation(fields: [maintenancePlanId], references: [id], onDelete: Cascade)
  task              Todo? // Auto-generated task (one-to-one relation via Todo.changeRequestId)

  // Hours tracking
  estimatedHours Float? // Estimated time for this request
  actualHours    Float? // Actual hours spent
  hoursDeducted  Float? // Hours deducted from monthly/rollover/pack
  hoursSource    String? // "monthly", "rollover", "pack"
  hourPackId     String? // If deducted from hour pack

  // Categorization
  category   ChangeRequestCategory @default(OTHER)
  priority   ChangeRequestPriority @default(NORMAL)
  urgencyFee Int                   @default(0) // Fee in cents for urgent requests

  // Billing
  isOverage        Boolean @default(false) // Beyond included hours
  overageAmount    Int? // Overage billing amount in cents
  flaggedForReview Boolean @default(false) // Needs billing review

  // Client approval for large requests
  requiresClientApproval Boolean   @default(false) // For >2hr estimates
  clientApprovedAt       DateTime?

  // Attachments
  attachments String[] // URLs to attached files

  @@map("change_requests")
}

model ProjectRequest {
  id           String        @id @default(cuid())
  name         String?
  email        String?
  projectType  String?
  goal         String?
  timeline     String?
  createdAt    DateTime      @default(now())
  company      String?
  contactEmail String        @default("")
  description  String        @default("")
  notes        String?
  resourcesUrl String?
  services     ServiceType[]
  title        String        @default("")
  updatedAt    DateTime      @default(now()) @updatedAt
  userId       String?
  budget       BudgetTier    @default(UNKNOWN)
  status       RequestStatus @default(DRAFT)
  user         User?         @relation(fields: [userId], references: [id])

  // Hours tracking
  estimatedHours Float? // Estimated hours set by client when creating request
  actualHours    Float? // Actual hours set by admin when completing request
  hoursDeducted  Float? // Hours deducted from maintenance plan
  hoursSource    String? // "monthly", "rollover", "pack" - where hours were deducted from
  hourPackId     String? // If deducted from hour pack

  @@map("project_requests")
}

// ============================================
// UNIFIED REQUEST SYSTEM (Replaces: Request, ChangeRequest, ProjectRequest, ClientTask)
// ============================================
model UnifiedRequest {
  id             String   @id @default(cuid())
  projectId      String?
  project        Project? @relation(fields: [projectId], references: [id], onDelete: Cascade)
  organizationId String?

  // Type determines behavior
  type UnifiedRequestType

  // Core fields
  title       String
  description String                 @db.Text
  status      UnifiedRequestStatus   @default(PENDING)
  priority    UnifiedRequestPriority @default(MEDIUM)

  // Hours tracking (for all billable work)
  estimatedHours Float?
  actualHours    Float?
  hoursDeducted  Float?
  hoursSource    String? // "monthly", "rollover", "pack", "billable"
  hourPackId     String?

  // Assignment
  assignedToId   String?
  assignedToRole UserRole?

  // Categorization
  category String? // Flexible categorization
  tags     String[] @default([])

  // Client interaction
  submittedBy      String? // Client user ID
  requiresApproval Boolean   @default(false)
  approvedAt       DateTime?
  approvedBy       String? // Admin user ID

  // Attachments and files
  attachments String[] @default([])

  // Completion
  completedAt DateTime?
  completedBy String?

  // Billing (for overage work)
  isBillable   Boolean @default(false)
  billedAmount Int? // Amount in cents
  invoiceId    String?

  // Linked task (auto-generated)
  todoId String? @unique

  // Metadata for type-specific data
  metadata Json? // Store type-specific fields here

  // Notes
  internalNotes String? @db.Text
  clientNotes   String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([projectId])
  @@index([organizationId])
  @@index([type])
  @@index([status])
  @@index([assignedToId])
  @@map("unified_requests")
}

model Activity {
  id          String       @id @default(cuid())
  type        ActivityType
  title       String
  description String?
  metadata    Json?
  userId      String?
  entityType  String?
  entityId    String?
  read        Boolean      @default(false)
  readAt      DateTime?
  createdAt   DateTime     @default(now())
  projectId   String?
  createdBy   String? // User ID or "SYSTEM"
  user        User?        @relation(fields: [userId], references: [id])

  @@index([createdAt])
  @@index([userId])
  @@index([read])
  @@index([projectId, createdAt])
  @@map("activities")
}

model MaintenanceSchedule {
  id           String            @id @default(cuid())
  projectId    String
  title        String
  description  String?
  status       MaintenanceStatus @default(UPCOMING)
  scheduledFor DateTime
  completedAt  DateTime?
  assignedToId String?
  notes        String?
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  project      Project           @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([status])
  @@index([scheduledFor])
  @@map("maintenance_schedules")
}

model LearningResource {
  id           String   @id @default(cuid())
  title        String
  description  String?
  type         String
  url          String
  category     String?
  thumbnailUrl String?
  duration     Int?
  difficulty   String?
  tags         String[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([category])
  @@index([type])
  @@map("learning_resources")
}

model Tool {
  id          String   @id @default(cuid())
  name        String
  description String?
  url         String
  category    String
  logoUrl     String?
  pricing     String?
  tags        String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([category])
  @@map("tools")
}

model Link {
  id          String       @id @default(cuid())
  title       String
  url         String
  description String?
  category    LinkCategory @default(OTHER)
  icon        String?
  color       String?
  order       Int          @default(0)
  pinned      Boolean      @default(false)
  createdById String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@index([category])
  @@index([pinned])
  @@index([order])
  @@map("links")
}

model Automation {
  id          String    @id @default(cuid())
  name        String
  description String?
  trigger     String
  action      String
  config      Json
  enabled     Boolean   @default(true)
  lastRunAt   DateTime?
  runCount    Int       @default(0)
  createdById String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([enabled])
  @@index([trigger])
  @@map("automations")
}

model Training {
  id          String       @id @default(cuid())
  title       String
  type        TrainingType
  description String
  visibility  Visibility   @default(INTERNAL)
  url         String?
  fileKey     String?
  tags        String[]
  createdById String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  assignments Assignment[]
  createdBy   User         @relation("TrainingCreatedBy", fields: [createdById], references: [id], onDelete: Cascade)

  @@index([visibility])
  @@index([type])
  @@index([createdById])
  @@map("trainings")
}

model Resource {
  id          String     @id @default(cuid())
  title       String
  description String
  url         String
  visibility  Visibility @default(INTERNAL)
  tags        String[]
  createdById String
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  createdBy   User       @relation("ResourceCreatedBy", fields: [createdById], references: [id], onDelete: Cascade)

  @@index([visibility])
  @@index([createdById])
  @@map("resources")
}

model ToolEntry {
  id          String     @id @default(cuid())
  name        String
  category    String
  url         String
  description String
  ownerTeamId String?
  visibility  Visibility @default(INTERNAL)
  icon        String?
  tags        String[]
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  @@index([visibility])
  @@index([category])
  @@map("tool_entries")
}

model Assignment {
  id           String       @id @default(cuid())
  trainingId   String
  audienceType AudienceType
  userId       String?
  teamId       String?
  role         UserRole?
  dueAt        DateTime?
  createdById  String
  createdAt    DateTime     @default(now())
  createdBy    User         @relation("AssignmentCreatedBy", fields: [createdById], references: [id], onDelete: Cascade)
  training     Training     @relation(fields: [trainingId], references: [id], onDelete: Cascade)
  completions  Completion[]

  @@index([trainingId])
  @@index([audienceType])
  @@index([userId])
  @@index([teamId])
  @@index([role])
  @@index([dueAt])
  @@map("assignments")
}

model Completion {
  id           String           @id @default(cuid())
  assignmentId String
  userId       String
  status       CompletionStatus @default(NOT_STARTED)
  startedAt    DateTime?
  completedAt  DateTime?
  notes        String?
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  assignment   Assignment       @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  user         User             @relation("CompletionUser", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([assignmentId, userId])
  @@index([userId])
  @@index([status])
  @@map("completions")
}

model FeedEvent {
  id        String   @id @default(cuid())
  projectId String
  type      String
  payload   Json?
  createdAt DateTime @default(now())
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId, createdAt])
  @@map("feed_events")
}

model MessageThread {
  id        String          @id @default(cuid())
  projectId String?
  clientId  String
  subject   String
  status    String          @default("open")
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  project   Project?        @relation(fields: [projectId], references: [id], onDelete: Cascade)
  messages  ThreadMessage[]

  @@index([projectId])
  @@index([clientId])
  @@map("message_threads")
}

model ThreadMessage {
  id        String        @id @default(cuid())
  threadId  String
  senderId  String
  role      String
  content   String
  createdAt DateTime      @default(now())
  thread    MessageThread @relation(fields: [threadId], references: [id], onDelete: Cascade)

  @@index([threadId, createdAt])
  @@map("thread_messages")
}

// REMOVED: BriefQuestionnaire model - orphaned, replaced by ProjectRequest system
// Keeping as comment for reference during migration
// model BriefQuestionnaire {
//   id                 String   @id @default(cuid())
//   userId             String   @unique
//   companyName        String
//   projectType        String
//   budgetRange        String
//   timelinePreference String
//   keyFeatures        Json
//   currentWebsite     String?
//   notes              String?
//   createdAt          DateTime @default(now())
//   user               User     @relation("UserBriefQuestionnaire", fields: [userId], references: [id], onDelete: Cascade)
//   @@map("brief_questionnaires")
// }

model ClientTask {
  id                    String                 @id @default(cuid())
  projectId             String
  title                 String
  description           String
  type                  String
  status                String                 @default("pending")
  dueDate               DateTime?
  completedAt           DateTime?
  data                  Json?
  assignedToClient      Boolean                @default(true)
  requiresUpload        Boolean                @default(false)
  submissionNotes       String?
  createdById           String?
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  project               Project                @relation(fields: [projectId], references: [id], onDelete: Cascade)
  createdBy             User?                  @relation("ClientTaskCreatedBy", fields: [createdById], references: [id])
  projectQuestionnaires ProjectQuestionnaire[]

  @@index([projectId])
  @@index([status])
  @@index([assignedToClient])
  @@map("client_tasks")
}

model ProjectQuestionnaire {
  id          String     @id @default(cuid())
  projectId   String     @unique
  taskId      String
  responses   Json
  completedAt DateTime?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  project     Project    @relation(fields: [projectId], references: [id], onDelete: Cascade)
  task        ClientTask @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([taskId])
  @@map("project_questionnaires")
}

model RevenueSplit {
  id            String   @id @default(cuid())
  projectId     String
  totalAmount   Decimal
  businessShare Decimal
  adminShares   Json
  notes         String?
  createdById   String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  project       Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  createdBy     User     @relation("RevenueSplitCreatedBy", fields: [createdById], references: [id])

  @@index([projectId])
  @@index([createdById])
  @@map("revenue_splits")
}

model AISuggestion {
  id          String   @id @default(cuid())
  projectId   String
  type        String
  title       String
  description String
  confidence  Int // 0-100
  source      String
  status      String   @default("NEW") // NEW, ACCEPTED, DISMISSED
  metadata    Json?
  createdAt   DateTime @default(now())

  @@index([projectId, status])
  @@map("ai_suggestions")
}

enum UserRole {
  ADMIN
  STAFF
  CLIENT
  CEO
  CFO
  DESIGNER
  DEV
  OUTREACH
  INTERN
  PARTNER
  FRONTEND
  BACKEND
}

enum OrgRole {
  OWNER
  ADMIN
  MEMBER
}

enum LeadStatus {
  NEW
  CONTACTED
  QUALIFIED
  PROPOSAL_SENT
  CONVERTED
  LOST
}

enum RequestStatus {
  DRAFT
  SUBMITTED
  REVIEWING
  NEEDS_INFO
  APPROVED
  REJECTED
  ARCHIVED
}

enum RequestSource {
  MANUAL
  AI
}

enum BudgetTier {
  UNKNOWN
  MICRO
  SMALL
  MEDIUM
  LARGE
  ENTERPRISE
}

enum ServiceType {
  WEB_APP
  WEBSITE
  ECOMMERCE
  AI_DATA
  MOBILE
  BRANDING
  OTHER
}

enum ProjectStatus {
  LEAD
  QUOTED
  DEPOSIT_PAID
  ACTIVE
  REVIEW
  COMPLETED
  MAINTENANCE
  CANCELLED
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  OVERDUE
  CANCELLED
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum NotificationType {
  INFO
  SUCCESS
  WARNING
  ERROR
}

enum FileType {
  IMAGE
  DOCUMENT
  VIDEO
  OTHER
}

enum VirusScanStatus {
  PENDING
  CLEAN
  INFECTED
  ERROR
}

enum ChannelType {
  GENERAL
  PROJECT
  SUPPORT
  DEVELOPMENT
  CUSTOM
}

enum TodoStatus {
  TODO
  IN_PROGRESS
  SUBMITTED
  AWAITING_PAYOUT
  DONE
}

enum TodoPriority {
  LOW
  MEDIUM
  HIGH
}

enum GoalStatus {
  NOT_STARTED
  IN_PROGRESS
  ON_TRACK
  AT_RISK
  DELAYED
  COMPLETED
  CANCELLED
}

enum GoalPriority {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum BlogStatus {
  DRAFT
  REVIEW
  SCHEDULED
  PUBLISHED
  ARCHIVED
}

enum ActivityType {
  LEAD_CREATED
  LEAD_UPDATED
  LEAD_DELETED
  PROJECT_CREATED
  PROJECT_UPDATED
  TASK_CREATED
  TASK_COMPLETED
  USER_JOINED
  INVOICE_PAID
  MAINTENANCE_DUE
  SYSTEM_ALERT
  FILE_UPLOAD
  MESSAGE
  MILESTONE
  PAYMENT
  STATUS_CHANGE
  // Prospect-specific activity types
  DISCOVERED
  ANALYZED
  REFRESHED_DETAILS
  STATUS_CHANGED
  EMAIL_DRAFTED
  EMAIL_SENT
  EMAIL_OPENED
  EMAIL_REPLIED
  NOTE_ADDED
  ARCHIVED
  CONVERTED
}

enum MaintenanceStatus {
  ACTIVE
  UPCOMING
  OVERDUE
  COMPLETED
  CANCELLED
}

enum LinkCategory {
  DESIGN
  DEVELOPMENT
  MARKETING
  TOOLS
  DOCUMENTATION
  OTHER
}

enum Visibility {
  INTERNAL
  PUBLIC
  CLIENT
}

enum AudienceType {
  USER
  TEAM
  ROLE
}

enum TrainingType {
  DOC
  VIDEO
  QUIZ
  LINK
}

enum CompletionStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETE
}

enum ServiceCategory {
  BUSINESS_WEBSITE
  NONPROFIT_WEBSITE
  PERSONAL_WEBSITE
  MAINTENANCE_PLAN
}

enum MaintenancePlanStatus {
  ACTIVE
  PAUSED
  CANCELLED
}

// ============================================
// NEW ENUMS FOR PLATFORM FEATURES
// ============================================

enum WebsiteQuality {
  POOR
  FAIR
  GOOD
  EXCELLENT
}

enum ProjectStage {
  DISCOVERY
  PROPOSAL
  DESIGN
  DEVELOPMENT
  REVIEW
  LAUNCH
  MAINTENANCE
}

enum TransactionType {
  DEPOSIT
  MILESTONE
  FINAL_PAYMENT
  MAINTENANCE_SUBSCRIPTION
  ADDON_SERVICE
  REFUND
}

enum TransactionStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
  CANCELLED
}

// New nonprofit tiers aligned with business model
enum NonprofitTier {
  ESSENTIALS // $500/mo, 8 hours, max 3 subscriptions
  DIRECTOR // $750/mo, 16 hours, max 6 subscriptions
  COO // $2,000/mo, unlimited requests (fair-use), unlimited subscriptions
}

// Hour pack types for marketplace purchases
enum HourPackType {
  SMALL // 5 hours, $350, 60-day expiry
  MEDIUM // 10 hours, $650, 90-day expiry
  LARGE // 20 hours, $1,200, 120-day expiry
  PREMIUM // 10 hours, $850, never expires
  COMPLIMENTARY // Keep for existing data
}

// Change request categories
enum ChangeRequestCategory {
  CONTENT // Content updates
  BUG // Bug fixes
  FEATURE // New features
  DESIGN // Design tweaks
  SEO // SEO optimization
  SECURITY // Security updates
  OTHER // Other
}

// Change request priority
enum ChangeRequestPriority {
  LOW // 3-5 days
  NORMAL // 2-3 days
  HIGH // 1 day
  URGENT // Same day (+$50 fee)
  EMERGENCY // Immediate (bypasses limits)
}

// Usage warning levels
enum UsageWarningLevel {
  AT_80_PERCENT // 80% of hours used
  AT_2_HOURS // 2 hours remaining
  AT_LIMIT // 0 hours remaining
  FIRST_OVERAGE // First time going over
  ROLLOVER_EXPIRING // Rollover hours expiring soon
  PACK_EXPIRING // Hour pack expiring soon
}

enum SubscriptionStatus {
  ACTIVE
  PAUSED
  CANCELLED
  EXPIRED
}

enum EmailCategory {
  CLIENT_OUTREACH
  PROPOSAL
  INVOICE
  PROJECT_UPDATE
  MEETING_SCHEDULING
  FOLLOW_UP
  WELCOME
  MAINTENANCE
}

enum CampaignStatus {
  DRAFT
  SCHEDULED
  SENDING
  SENT
  PAUSED
}

enum EventStatus {
  PENDING
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  RESCHEDULED
}

enum ChatStatus {
  ACTIVE // Currently chatting
  WAITING_FOR_HUMAN // Flagged for human, waiting
  WITH_HUMAN // Human has taken over (old name kept for compatibility)
  HUMAN_ACTIVE // Human has taken over
  RESOLVED // Conversation ended
  ABANDONED
  ARCHIVED // Archived/hidden
}

enum AIMessageRole {
  USER // Visitor message
  ASSISTANT // AI response
  HUMAN // Human team member response
  SYSTEM // System message like "Sean has joined the chat"
}

// ============================================
// NEW AUTH & SETTINGS MODELS
// ============================================

model UserProfile {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Business info (for clients)
  organizationName String?
  industry         String?
  organizationSize String?
  websiteUrl       String?
  taxId            String?
  businessAddress  String?

  // Professional info (for designers/admins)
  jobTitle           String?
  department         String?
  skills             String[] // Array of skill tags
  portfolioUrl       String?
  githubUrl          String?
  linkedinUrl        String?
  yearsExperience    Int?
  hourlyRate         Decimal? @db.Decimal(10, 2)
  availabilityStatus String?  @default("available")

  // Social links
  twitterUrl String?
  customLink String?

  // Privacy
  publicProfile Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("user_profiles")
}

model TwoFactorAuth {
  id          String    @id @default(cuid())
  userId      String    @unique
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  secret      String // Encrypted TOTP secret
  backupCodes String[] // Encrypted backup codes
  enabled     Boolean   @default(false)
  verifiedAt  DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@map("two_factor_auth")
}

model UserSession {
  id         String   @id @default(cuid())
  userId     String
  user       User     @relation("UserSessions", fields: [userId], references: [id], onDelete: Cascade)
  deviceInfo String?
  browser    String?
  os         String?
  ipAddress  String?
  location   String?
  lastActive DateTime @default(now())
  createdAt  DateTime @default(now())

  @@index([userId])
  @@map("user_sessions")
}

model NotificationPreferences {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Email notifications
  projectUpdatesEmail Boolean @default(true)
  billingEmail        Boolean @default(true)
  marketingEmail      Boolean @default(false)
  securityEmail       Boolean @default(true)

  // In-app notifications
  projectUpdatesApp Boolean @default(true)
  billingApp        Boolean @default(true)
  securityApp       Boolean @default(true)

  // Push notifications
  browserPushEnabled Boolean @default(false)

  // Schedule
  quietHoursStart String? // "22:00"
  quietHoursEnd   String? // "08:00"
  digestFrequency String? @default("none") // daily, weekly, none

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("notification_preferences")
}

model UserPreferences {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Appearance
  theme            String  @default("dark") // light, dark, auto
  accentColor      String? @default("#dc2626") // trinity-red
  fontSize         String  @default("medium") // small, medium, large
  reduceAnimations Boolean @default(false)

  // Language & Region
  language   String @default("en")
  dateFormat String @default("MM/DD/YYYY")
  timeFormat String @default("12h") // 12h, 24h

  // Dashboard
  defaultView      String  @default("kanban") // kanban, list, calendar
  sidebarCollapsed Boolean @default(false)
  compactMode      Boolean @default(false)

  // Communication
  preferredContact  String? // email, phone, sms
  responseTime      String?
  meetingPreference String? // in-person, video, phone
  bestTime          String? // morning, afternoon, evening

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("user_preferences")
}

model TosAcceptance {
  id         String   @id @default(cuid())
  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  version    String // e.g., "1.0"
  acceptedAt DateTime @default(now())
  ipAddress  String?
  userAgent  String?

  @@index([userId])
  @@map("tos_acceptances")
}

model LoginHistory {
  id         String   @id @default(cuid())
  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  success    Boolean  @default(true)
  ipAddress  String?
  location   String?
  deviceInfo String?
  browser    String?
  os         String?
  createdAt  DateTime @default(now())

  @@index([userId, createdAt])
  @@map("login_history")
}

// ============================================
// SEEZEE PLATFORM FEATURES - NEW MODELS
// ============================================

// Time tracking for tasks
model TimeLog {
  id          String    @id @default(cuid())
  todoId      String
  todo        Todo      @relation(fields: [todoId], references: [id], onDelete: Cascade)
  hoursSpent  Float
  description String?
  performedBy String? // User ID
  startedAt   DateTime?
  endedAt     DateTime?
  createdAt   DateTime  @default(now())

  @@index([todoId])
  @@map("time_logs")
}

// Maintenance activity logs
model MaintenanceLog {
  id          String          @id @default(cuid())
  planId      String
  plan        MaintenancePlan @relation(fields: [planId], references: [id], onDelete: Cascade)
  hoursSpent  Float
  description String
  performedBy String? // User ID of staff member
  performedAt DateTime        @default(now())
  billable    Boolean         @default(true)
  overage     Boolean         @default(false) // true if beyond included hours
  createdAt   DateTime        @default(now())

  @@index([planId])
  @@index([performedAt])
  @@map("maintenance_logs")
}

// Purchased hour packs for additional work
model HourPack {
  id              String          @id @default(cuid())
  planId          String
  plan            MaintenancePlan @relation(fields: [planId], references: [id], onDelete: Cascade)
  packType        HourPackType
  hours           Float // Total hours in pack
  hoursRemaining  Float // Hours still available
  cost            Int // Cost in cents
  purchasedAt     DateTime        @default(now())
  expiresAt       DateTime? // Null for never-expire packs
  neverExpires    Boolean         @default(false)
  stripePaymentId String?

  // Extension tracking
  timesExtended  Int       @default(0)
  originalExpiry DateTime? // Original expiry before extensions

  // Usage
  usedAt   DateTime? // When fully used
  isActive Boolean   @default(true)

  @@index([planId])
  @@index([expiresAt])
  @@index([isActive])
  @@map("hour_packs")
}

// Rollover hours tracking with FIFO expiration
model RolloverHours {
  id             String          @id @default(cuid())
  planId         String
  plan           MaintenancePlan @relation(fields: [planId], references: [id], onDelete: Cascade)
  hours          Float // Hours rolled over
  hoursRemaining Float // Hours still available
  sourceMonth    DateTime // Which month these came from
  expiresAt      DateTime // When these hours expire
  usedAt         DateTime? // When fully used
  isExpired      Boolean         @default(false)

  @@index([planId])
  @@index([expiresAt])
  @@map("rollover_hours")
}

// Track overage and warning notifications sent
model OverageNotification {
  id           String            @id @default(cuid())
  planId       String
  plan         MaintenancePlan   @relation(fields: [planId], references: [id], onDelete: Cascade)
  warningLevel UsageWarningLevel
  periodStart  DateTime // Which billing period this is for
  sentAt       DateTime          @default(now())
  emailTo      String // Email address sent to

  // For expiring hours/packs
  expiryDate    DateTime? // Date of expiring hours/pack
  hoursExpiring Float? // How many hours are expiring

  @@unique([planId, warningLevel, periodStart]) // Prevent duplicate warnings per period
  @@index([planId])
  @@map("overage_notifications")
}

// Finance transactions
model FinanceTransaction {
  id                   String            @id @default(cuid())
  projectId            String?
  project              Project?          @relation(fields: [projectId], references: [id])
  organizationId       String?
  organization         Organization?     @relation(fields: [organizationId], references: [id])
  type                 TransactionType
  amount               Int // in cents
  currency             String            @default("USD")
  status               TransactionStatus @default(PENDING)
  stripeInvoiceId      String?           @unique
  stripePaymentId      String?           @unique
  stripeSubscriptionId String?
  paymentMethod        String? // card, ach, manual
  description          String
  dueDate              DateTime?
  paidAt               DateTime?
  metadata             Json?
  notes                String?
  createdAt            DateTime          @default(now())
  updatedAt            DateTime          @updatedAt

  @@index([projectId])
  @@index([organizationId])
  @@index([status])
  @@map("finance_transactions")
}

// Email templates
model EmailTemplate {
  id          String             @id @default(cuid())
  name        String             @unique
  category    EmailCategory
  subject     String
  htmlContent String             @db.Text
  textContent String?            @db.Text
  variables   String[] // e.g., ["clientName", "projectName", "amount"]
  active      Boolean            @default(true)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  campaigns   EmailCampaign[]
  dripSteps   DripCampaignStep[]

  @@index([category])
  @@map("email_templates")
}

// Email campaigns for outreach
model EmailCampaign {
  id           String         @id @default(cuid())
  name         String
  templateId   String
  template     EmailTemplate  @relation(fields: [templateId], references: [id])
  targetStatus LeadStatus[]
  targetTags   String[]
  minLeadScore Int?
  status       CampaignStatus @default(DRAFT)
  scheduledFor DateTime?
  sentAt       DateTime?
  totalSent    Int            @default(0)
  opened       Int            @default(0)
  clicked      Int            @default(0)
  replied      Int            @default(0)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt

  // Track which leads were targeted
  leads Lead[] @relation("LeadCampaigns")

  @@index([status])
  @@map("email_campaigns")
}

// Drip campaigns - automated email sequences
model DripCampaign {
  id          String   @id @default(cuid())
  name        String
  description String?
  active      Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Targeting criteria
  targetStatus     ProspectStatus[]
  targetTags       String[]
  minLeadScore     Int?
  maxLeadScore     Int?
  targetCategories String[] // Industry categories to target
  targetStates     String[] // Geographic targeting

  // Campaign steps
  steps       DripCampaignStep[]
  enrollments DripEnrollment[]

  // Analytics
  totalEnrolled     Int @default(0)
  totalCompleted    Int @default(0)
  totalUnsubscribed Int @default(0)

  @@index([active])
  @@map("drip_campaigns")
}

// Individual steps in a drip campaign
model DripCampaignStep {
  id         String       @id @default(cuid())
  campaignId String
  campaign   DripCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  stepNumber Int // Order in sequence (1, 2, 3...)
  delayDays  Int // Days after previous step (0 for first step)
  delayHours Int           @default(0) // Additional hours for fine-tuning
  templateId String
  template   EmailTemplate @relation(fields: [templateId], references: [id])

  // Step-specific conditions (optional)
  skipIfReplied Boolean @default(true) // Skip if prospect already replied
  skipIfOpened  Boolean @default(false) // Skip if previous email was opened

  // Analytics for this specific step
  sent      Int @default(0)
  delivered Int @default(0)
  opened    Int @default(0)
  clicked   Int @default(0)
  replied   Int @default(0)
  bounced   Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([campaignId, stepNumber])
  @@index([campaignId])
  @@map("drip_campaign_steps")
}

// Prospect enrollment in drip campaigns
model DripEnrollment {
  id         String       @id @default(cuid())
  campaignId String
  campaign   DripCampaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  prospectId String
  prospect   Prospect     @relation(fields: [prospectId], references: [id], onDelete: Cascade)

  enrolledAt   DateTime @default(now())
  currentStep  Int      @default(0) // Current step number (0 = not started yet)
  completed    Boolean  @default(false)
  unsubscribed Boolean  @default(false)
  paused       Boolean  @default(false)

  nextEmailAt DateTime? // When next email should be sent
  lastEmailAt DateTime? // When last email was sent

  // Engagement tracking
  totalOpened  Int       @default(0)
  totalClicked Int       @default(0)
  repliedAt    DateTime?

  // Completion tracking
  completedAt    DateTime?
  unsubscribedAt DateTime?

  @@unique([campaignId, prospectId])
  @@index([campaignId])
  @@index([prospectId])
  @@index([nextEmailAt])
  @@index([unsubscribed])
  @@map("drip_enrollments")
}

// Calendar events
model CalendarEvent {
  id             String        @id @default(cuid())
  title          String
  description    String?       @db.Text
  location       String?
  startTime      DateTime
  endTime        DateTime
  allDay         Boolean       @default(false)
  timezone       String        @default("America/New_York")
  organizationId String?
  organization   Organization? @relation(fields: [organizationId], references: [id])
  projectId      String?
  project        Project?      @relation(fields: [projectId], references: [id])
  createdBy      String // User ID
  attendees      String[] // User IDs or email addresses
  meetingUrl     String? // Zoom, Google Meet, etc.
  recurring      Boolean       @default(false)
  recurrenceRule String? // iCal RRULE format
  status         EventStatus   @default(SCHEDULED)
  remindersSent  Boolean       @default(false)
  color          String? // For calendar display
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  @@index([startTime])
  @@index([organizationId])
  @@index([projectId])
  @@map("calendar_events")
}

// AI Chatbot conversations (separate from team ChatMessage)
model AIConversation {
  id            String      @id @default(cuid())
  sessionId     String      @unique
  visitorId     String?     @unique // Unique visitor identifier
  userId        String? // If logged in user
  visitorName   String?
  visitorEmail  String?
  visitorPhone  String?
  organization  String? // Organization name if provided
  messages      AIMessage[]
  status        ChatStatus  @default(ACTIVE)
  handedOff     Boolean     @default(false)
  handedOffTo   String? // Admin user ID
  handedOffAt   DateTime? // When human took over
  handoffReason String? // Why handoff was requested
  intent        String? // "pricing", "portfolio", "support", etc.
  leadQuality   String? // "hot", "warm", "cold"
  leadScore     Int? // Numeric lead score 0-100
  source        String? // URL where chat started
  referrer      String? // HTTP referrer
  device        String?
  browser       String?
  ipAddress     String?
  userAgent     String?
  location      String? // Geographic location if available
  aiSummary     String?     @db.Text // AI-generated summary of conversation
  detectedNeeds String[] // Array of detected needs like ["website", "donations", "crm"]
  tags          String[] // Tags like ["nonprofit", "urgent", "hot-lead"]
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  closedAt      DateTime?

  @@index([status])
  @@index([createdAt])
  @@index([visitorId])
  @@map("ai_conversations")
}

// AI chat messages
model AIMessage {
  id             String         @id @default(cuid())
  conversationId String
  conversation   AIConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  role           AIMessageRole
  senderName     String? // "SeeZee AI", "Sean", "Visitor"
  content        String         @db.Text
  modelUsed      String?
  tokens         Int?
  confidence     Float?
  isRead         Boolean        @default(false)
  readAt         DateTime?
  attachments    String[] // URLs to uploaded files
  createdAt      DateTime       @default(now())

  @@index([conversationId])
  @@index([createdAt])
  @@map("ai_messages")
}

// Session recordings for AI transcription
model Recording {
  id              String             @id @default(cuid())
  title           String
  filename        String? // Optional - only for backward compatibility
  filePath        String? // Optional - only for backward compatibility
  fileSize        Int? // Optional - only for backward compatibility
  mimeType        String? // Optional - only for backward compatibility
  duration        Int? // Duration in seconds (optional)
  status          RecordingStatus    @default(PENDING)
  category        RecordingCategory? // AI-tagged category based on content
  transcript      String?            @db.Text // Optional - manually pasted transcript
  summary         String?            @db.Text
  actionItems     Json? // Array of action items extracted
  projectBrief    Json? // Auto-generated project brief
  isClientVisible Boolean            @default(false) // Whether client can view
  uploadedById    String
  uploadedBy      User               @relation("RecordingsUploaded", fields: [uploadedById], references: [id])
  projectId       String?
  project         Project?           @relation(fields: [projectId], references: [id])
  transcribedAt   DateTime?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt

  @@index([status])
  @@index([category])
  @@index([uploadedById])
  @@index([projectId])
  @@map("recordings")
}

enum RecordingCategory {
  DISCOVERY_CALL // Initial client meeting
  DESIGN_REVIEW // Design feedback session
  TECHNICAL_DISCUSSION // Development/tech talk
  PROJECT_UPDATE // Progress update meeting
  BRAINSTORMING // Ideation session
  TRAINING // Client training/onboarding
  SUPPORT // Support/troubleshooting
  INTERNAL // Internal team meeting
  OTHER // Uncategorized
}

enum RecordingStatus {
  PENDING
  PROCESSING
  TRANSCRIBED
  ERROR
}

// Business expense categories
enum ExpenseCategory {
  SOFTWARE // Vercel, Cursor, GitHub, etc.
  HOSTING // Server costs, domains
  TOOLS // Development tools
  MARKETING // Ads, promotions
  SUBSCRIPTIONS // SaaS subscriptions
  OFFICE // Office supplies
  PAYROLL // Contractor payments
  UTILITIES // Internet, phone
  TRAVEL // Business travel
  MEALS // Client meals, team meals
  EQUIPMENT // Hardware, devices
  LEGAL // Legal fees
  INSURANCE // Business insurance
  EDUCATION // Courses, training
  OTHER // Miscellaneous
}

enum ExpenseStatus {
  PENDING // Not yet paid
  PAID // Payment completed
  RECURRING // Auto-recurring expense
  CANCELLED // Cancelled
}

// Business expenses tracking
model BusinessExpense {
  id          String          @id @default(cuid())
  name        String // e.g., "Vercel Pro", "Cursor Subscription"
  description String?
  amount      Int // in cents
  currency    String          @default("USD")
  category    ExpenseCategory
  status      ExpenseStatus   @default(PAID)
  vendor      String? // e.g., "Vercel", "Cursor", "OpenAI"

  // Recurring expense tracking
  isRecurring Boolean   @default(false)
  frequency   String? // "monthly", "yearly", "quarterly"
  nextDueDate DateTime?

  // Date tracking
  expenseDate DateTime  @default(now())
  paidAt      DateTime?

  // Optional references
  receiptUrl String? // Link to receipt/invoice
  notes      String?
  tags       String[] // Custom labels

  // Audit fields
  createdBy String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([category])
  @@index([status])
  @@index([vendor])
  @@index([expenseDate])
  @@map("business_expenses")
}

// Monthly budget tracking
model MonthlyBudget {
  id           String          @id @default(cuid())
  category     ExpenseCategory
  budgetAmount Int // in cents
  month        Int // 1-12
  year         Int
  notes        String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([category, month, year])
  @@map("monthly_budgets")
}

enum ProspectStatus {
  PROSPECT // Just discovered, not reviewed yet
  REVIEWING // Currently being reviewed by team
  QUALIFIED // Reviewed and marked as good lead
  DRAFT_READY // Email drafted but not sent
  CONTACTED // Email sent
  RESPONDED // They replied
  MEETING // Meeting scheduled
  PROPOSAL // Sent proposal
  NEGOTIATING // Discussing terms
  CONVERTED // Became paying client
  LOST // Decided not to pursue
  ARCHIVED // Old/irrelevant
}

enum EmailStatus {
  DRAFT
  QUEUED
  SENT
  DELIVERED
  OPENED
  CLICKED
  REPLIED
  BOUNCED
  FAILED
}

// ============================================
// UNIFIED REQUEST SYSTEM ENUMS
// ============================================

enum UnifiedRequestType {
  NEW_PROJECT // Brand new project request (was ProjectRequest)
  CHANGE_REQUEST // Change to existing project (was ChangeRequest)
  MAINTENANCE_TASK // Regular maintenance work (was Request)
  CLIENT_TASK // Task assigned to client (was ClientTask)
  SUPPORT_REQUEST // Support/help request
  BUG_REPORT // Bug fix request
  FEATURE_REQUEST // New feature request
  CONTENT_UPDATE // Content/copy changes
  CONSULTATION // Meeting or consultation request
  OTHER // Other request types
}

enum UnifiedRequestStatus {
  DRAFT // Not yet submitted
  PENDING // Submitted, awaiting review
  REVIEWING // Being reviewed by team
  NEEDS_INFO // Requires more information from client
  APPROVED // Approved and ready to work on
  IN_PROGRESS // Currently being worked on
  BLOCKED // Blocked by dependency or issue
  AWAITING_CLIENT // Waiting for client feedback/approval
  TESTING // In testing/QA phase
  COMPLETED // Work completed
  DELIVERED // Delivered to client
  REJECTED // Request declined
  CANCELLED // Cancelled by client or admin
  ARCHIVED // Archived/closed
}

enum UnifiedRequestPriority {
  LOW // 5-7 days
  MEDIUM // 2-4 days
  HIGH // 1-2 days
  URGENT // Same day (may incur fee)
  EMERGENCY // Immediate (production down)
}

// ============================================
// VERCEL DEPLOYMENT TRACKING
// ============================================

model VercelDeployment {
  id            String   @id @default(cuid())
  deploymentId  String   @unique // Vercel deployment ID
  name          String // Project name
  url           String // Deployment URL
  inspectorUrl  String? // Vercel inspector URL
  state         String // BUILDING, READY, ERROR, CANCELED, etc.
  target        String? // production, preview, development
  createdAt     DateTime
  buildingAt    DateTime?
  readyAt       DateTime?
  
  // Git metadata
  branch        String?
  commitSha     String?
  commitMessage String?
  commitAuthor  String?
  repo          String?
  
  // Webhook metadata
  webhookEvent  String? // Event type that triggered this
  rawData       Json? // Full webhook payload for debugging
  
  updatedAt     DateTime @updatedAt
  
  @@index([state])
  @@index([target])
  @@index([createdAt])
  @@map("vercel_deployments")
}

// ============================================
// AI NODES EXECUTION SYSTEM ENUMS
// ============================================

enum NodeStatus {
  ONLINE
  BUSY
  OFFLINE
  ERROR
}

enum ExecutionRequestStatus {
  QUEUED
  CLAIMED
  COMPLETED
  CANCELLED
}

enum RunStatus {
  RUNNING
  DONE
  FAILED
  NEEDS_ANSWER
}

enum RequestPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}
